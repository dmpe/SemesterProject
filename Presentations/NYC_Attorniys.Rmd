---
title: "NYC Attorney"
author: "Dmitrij Petrov"
date: "24. 4. 2015"
output:
  html_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 8
---

# Goal
Look at the US NYS Attorney Registrations. 

Source of data : <https://data.ny.gov/Transparency/NYS-Attorney-Registrations/eqw2-r5nb>

## Get the data

First we load some libraries.

```{r}
library(readr)
library(stringr)
library(stringi)
library(plyr)
library(dplyr)
```

I used CSV file downloaded from their website. Using `readr` package I skip 4 columns which are low interest to me and finally present a summary statistics. Here I am going to deal with characters only.

```{r}

data.NYS <- readr::read_csv("/srv/shiny-server/SemesterProject/Data/NYS_Attorney_Registrations.csv",
                            col_types = list("Zip" = col_character(), "Zip Plus Four" = col_character(), 
                                             "Suffix" = col_skip(), "Middle Name" = col_skip()))

summary(data.NYS)
```

## Data cleansing

Because data contain blank cells, I need to replace "" (basically nothing - empty spaces) with NAs. Then I also rename columns.

```{r}
data.NYS[data.NYS == ""] <- NA
colnames(data.NYS) <- c("ID", "F.Name", "L.Name", "Comp.Name", "Street_1", "Street_2", "City", "State", "Zip", "Zip_2", "Country", "County",  "Phone", "Email", "Year_Adm", "JDoA", "Law_School", "Status", "Next_Reg")
```

### What kind of email providers lawyers used to register ?

Using `stringi` package we split Email column into a matrix. Then we omit NAs (i.e. those cells that we replaced above) and "convert" the matrix to a data frame. Letters before @ get "NickName" column name and after @ "Organisation". Because people cannot fill their email properly (or maybe because of <http://rickrobinson.files.wordpress.com/2012/10/it-systems.jpg>) I need to use `tolower` function. 

Finally using `table` function I get frequencies of email providers. [#Google](https://www.google.de/search?q=gmail+is+unique) leads.

```{r}
splitted.email <- stri_split_fixed(data.NYS$Email, "@", 2, omit_empty = NA, simplify = TRUE) 
splitted.email <- data.frame(na.omit(splitted.email))
colnames(splitted.email) <- c("NickName", "Organisation")

splitted.email <- data.frame(table(tolower(splitted.email$Organisation)))
splitted.email <- plyr::arrange(splitted.email, desc(splitted.email$Freq))
head(splitted.email, 15)


```

Not so many law firm, right.

### 
